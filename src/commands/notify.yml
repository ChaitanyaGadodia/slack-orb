description: Notify a Slack channel with a custom message

parameters:
  webhook:
    description: Enter either your Webhook value or use the CircleCI UI to add your token under the 'SLACK_WEBHOOK' env var
    type: string
    default: ${SLACK_WEBHOOK}
  template:
    description: "Use one of the built-in templates. Select the template name. Preview each template on the gitHub Readme: "
    type: string
    default: ""
  custom:
    description: |
      Enter a custom message template.

      1. Create your message template using the Block Kit Builder: https://app.slack.com/block-kit-builder/.
      2. Insert any desired environment variables.
      3. Paste value here.
    type: string
    default: ""
  event:
    description: |
      In what event should this message send? Options: ["fail", "pass", "always"]
    type: enum
    enum: ["fail", "pass", "always"]
    default: "always"
  mentions:
    description: A comma separated list of user IDs. No spaces.
    type: string
    default: ""

steps:
  - run:
      when: on_fail
      name: Slack - Detecting Job Status (FAIL)
      command: |
        echo `export CCI_STATUS="fail"` >> $BASH_ENV
  - run:
      when: on_success
      name: Slack - Detecting Job Status (PASS)
      command: |
        CCI_STATUS="pass" >> $BASH_ENV
  - run:
      when: always
      name: Slack - Sending Notification
      environment:
        # import pre-built templates using the orb-pack local script include.
        basic-fail-1: <<include(message_templates/basic_fail_1.json)>>
      command: <<include(scripts/notify.sh)>>